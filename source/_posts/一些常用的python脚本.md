---
title: 一些常用的python脚本
date: 2023-02-23 14:24:00
tags:
- MD
- LAMMPS
---
* data2molecule
* data2POSCAR
* DFT_deform 
  <!--more-->
## data2molecule
```python
import pandas as pd
import numpy as np
import os
import time
modelname="8_lmp"
csvname=modelname+".csv"
f = pd.read_csv(modelname+".data", header=None)
str = [' atoms', ' bonds', ' angles', ' dihedrals', ' impropers', ' atom types', ' bond types', ' angle types',
       ' dihedral types', ' improper types', 'xlo xhi', 'ylo yhi', 'zlo zhi', 'Masses', 'Atoms', 'Velocities', 'Bonds', 'Angles',
       'Dihedrals', 'Impropers']
N = len(str)
p = ' Impropers'
row_id = np.zeros(N)

for i in range(N):
    q = f[f[0].str.contains(str[i])].index.tolist()
    if len(q) == 1:
        row_id[i] = q[0]

row_id.tolist()


## 筛选特定行 并 提取信息
id_bo = int(row_id[16])
id_an = int(row_id[17])
id_di = int(row_id[18])
id_im = int(row_id[19])
## 定义特定拓扑结构字符串并新建mol文件
inistr = ["\t", "Coords", "\t", "Types", "\t", "Charges", "\t", "Bonds", "\t", "Angles", "\t", "Dihedrals", "\t",
          "Impropers", "\t"]
strinsert = pd.DataFrame(inistr)
mol = open(modelname+".csv", 'w')
info = ["#molecule file generated by python --JiahaoLi  " + time.strftime('%Y:%m:%d %H:%M:%S',
                                                                          time.localtime(int(time.time()))), "\t"];
pd.DataFrame([info]).to_csv(csvname, mode='a', index=None, header=False)
for i in range(5):
    f.iloc[int(row_id[i])].to_csv(csvname, mode='a', index=None, header=False)
xyz = f.iloc[int(row_id[14]) + 1:int(row_id[15])]
p = xyz[0].str.split(' ', expand=True)

# 输出头文件
strinsert[0:3].to_csv(csvname, mode='a', index=None, header=False)

tp = pd.merge(p.iloc[:, 0], p.iloc[:, 4:7], left_index=True, right_index=True)
tp.to_csv(csvname, mode='a', index=None, header=False, sep=' ')
strinsert[2:5].to_csv(csvname, mode='a', index=None, header=False)
tp = pd.merge(p.iloc[:, 0], p.iloc[:, 2], left_index=True, right_index=True)
tp.to_csv(csvname, mode='a', index=None, header=False, sep=' ')
strinsert[4:7].to_csv(csvname, mode='a', index=None, header=False)
tp = pd.merge(p.iloc[:, 0], p.iloc[:, 3], left_index=True, right_index=True)
tp.to_csv(csvname, mode='a', index=None, header=False, sep=' ')
## 输出拓扑信息数目
# mol.close()
if id_bo == 0:
    mol.close()
elif (id_bo != 0) & (id_an != 0) & (id_di != 0) & (id_im != 0):
    strinsert[6:9].to_csv(csvname, mode='a', header=False, index=None)
    p = f.iloc[id_bo + 1:id_an]
    p.to_csv(csvname, mode='a', index=None, header=False)
    strinsert[8:11].to_csv(csvname, mode='a', header=False, index=None)
    f.iloc[id_an + 1:id_di].to_csv(csvname, mode='a', index=None, header=False)
    strinsert[10:13].to_csv(csvname, mode='a', header=False, index=None)
    f.iloc[id_di + 1:id_im].to_csv(csvname, mode='a', index=None, header=False)
    strinsert[12::].to_csv(csvname, mode='a', header=False, index=None)
    f.iloc[id_im + 1::].to_csv(csvname, mode='a', index=None, header=False)

elif (id_bo != 0) & (id_an != 0) & (id_di != 0) & (id_im == 0):
    strinsert[6:9].to_csv(csvname, mode='a', header=False, index=None)
    f.iloc[id_bo + 1:id_an].to_csv(csvname, mode='a', index=None, header=False)
    strinsert[8:11].to_csv(csvname, mode='a', header=False, index=None)
    f.iloc[id_an + 1:id_di].to_csv(csvname, mode='a', index=None, header=False)
    strinsert[10:13].to_csv(csvname, mode='a', header=False, index=None)
    f.iloc[id_di + 1::].to_csv(csvname, mode='a', index=None, header=False)

elif (id_bo != 0) & (id_an != 0) & (id_di == 0) & (id_im != 0):
    strinsert[6:9].to_csv(csvname, mode='a', header=False, index=None)
    f.iloc[id_bo + 1:id_an].to_csv(csvname, mode='a', index=None, header=False)
    strinsert[8:11].to_csv(csvname, mode='a', header=False, index=None)
    f.iloc[id_an + 1:id_im].to_csv(csvname, mode='a', index=None, header=False)
    strinsert[12::].to_csv(csvname, mode='a', header=False, index=None)
    f.iloc[id_im + 1::].to_csv(csvname, mode='a', index=None, header=False)


elif (id_bo != 0) & (id_an != 0) & (id_di == 0) & (id_im == 0):
    strinsert[6:9].to_csv(csvname, mode='a', header=False, index=None)
    f.iloc[id_bo + 1:id_an].to_csv(csvname, mode='a', index=None, header=False)
    strinsert[8:11].to_csv(csvname, mode='a', header=False, index=None)
    f.iloc[id_an + 1::].to_csv(csvname, mode='a', index=None, header=False)


elif (id_bo != 0) & (id_an == 0) & (id_di != 0) & (id_im != 0):
    strinsert[6:9].to_csv(csvname, mode='a', header=False, index=None)
    f.iloc[id_bo + 1:id_di].to_csv(csvname, mode='a', index=None, header=False)
    strinsert[10:13].to_csv(csvname, mode='a', header=False, index=None)
    f.iloc[id_di + 1:id_im].to_csv(csvname, mode='a', index=None, header=False)
    strinsert[12::].to_csv(csvname, mode='a', header=False, index=None)
    f.iloc[id_im + 1::].to_csv(csvname, mode='a', index=None, header=False)

elif (id_bo != 0) & (id_an == 0) & (id_di != 0) & (id_im == 0):
    strinsert[6:9].to_csv(csvname, mode='a', header=False, index=None)
    f.iloc[id_bo + 1:id_di].to_csv(csvname, mode='a', header=False, index=None)
    strinsert[10:13].to_csv(csvname, mode='a', header=False, index=None)
    f.iloc[id_di + 1::].to_csv(csvname, mode='a', index=None, header=False)

elif (id_bo != 0) & (id_an == 0) & (id_di == 0) & (id_im != 0):
    strinsert[6:9].to_csv(csvname, mode='a', header=False, index=None)
    f.iloc[id_bo + 1:id_im].to_csv(csvname, mode='a', index=None, header=False)
    strinsert[12::].to_csv(csvname, mode='a', header=False, index=None)
    f.iloc[id_im + 1::].to_csv(csvname, mode='a', index=None, header=False)

elif (id_bo != 0) & (id_an == 0) & (id_di == 0) & (id_im == 0):
    strinsert[6:9].to_csv(csvname, mode='a', header=False, index=None)
    f.iloc[id_bo + 1::].to_csv(csvname, mode='a', index=None, header=False)
mol.close()
os.rename(modelname+".csv", modelname+".mol")
# m=f.iloc[id_bo:id_an]
```
## data2POSCAR（其实没什么必要,ovito可以直接转换。。。。。。）

```python
import numpy as np
import pandas as pd
import os
f=pd.read_table("C7H7N",header=None,delim_whitespace=True).fillna(' ')
xx=f.index[f[2].str.contains('xlo')].tolist()
xx=xx[0]
yy=f.index[f[2].str.contains('ylo')].tolist()
yy=yy[0]
zz=f.index[f[2].str.contains('zlo')].tolist()
zz=zz[0]
xlength=float(f[1][xx])-float(f[0][xx])
ylength=float(f[1][yy])-float(f[0][yy])
zlength=float(f[1][zz])-float(f[0][zz])
a=f.index[f[0].str.contains('Masses')].tolist()
a=a[0]
b=f.index[f[0].str.contains('Atoms')].tolist()
b=b[0]
ele=f[3][a+1:b]
c_type=f[2].iloc[b+1::].tolist()
ele_name=""
ele_num=""
for i in range(len(ele)):
    ele_name=ele_name+f[3].iloc[a+i+1]+" "
    ele_num=ele_num+str(c_type.count(f[0].iloc[a+i+1]))+" "
txyz=f.loc[b+1::,[2,4,5,6]]
txyz.sort_values(2,inplace=True)
xyz=txyz.loc[b+1::,[4,5,6]]
mol=open("POSCAR",'a')
mol.write("POSCAR generated by python ##Jiahao \n 1 \n")
mol.write(str(xlength)+" "+"0.0 0.0\n"+"0.0 "+str(ylength)+" 0.0\n"+"0.0 0.0 "+str(zlength)+"\n")
mol.write(ele_name+"\n"+ele_num+"\n"+"Castein \n")
mol.close()
xyz.to_csv('POSCAR',index=False,header=0,mode='a',sep=' ')
```
## DFT计算材料变形

```bash
#!/bin/sh
rm -r POSCAR
cp CONTCAR CONTCAR.$@
cp OSZICAR  OSZICAR.$@
mv CONTCAR POSCAR.$@
awk 'BEGIN{my_a = 0.01; my_b = 0}{
        if ((NR<=33&&NR>=10)||( NR<=102&&NR>=66 )||(NR<=110&&NR>=106)||(NR<=126&&NR>=112))  
	{
            my_b = $2 + my_a;
            if (my_b > 1)
                my_b = my_b - 1;
            printf("%.7f %.7f %.7f %s %s %s\n",$1, my_b,$3,$4,$5,$6);
        }    
        else print $0;
    }'  POSCAR.$@>POSCAR
```
